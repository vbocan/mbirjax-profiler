# MBIRJAX Profiler for FPGA Optimization Analysis
# CPU-only profiling with cProfile for performance analysis

services:
  mbirjax-profiler:
    build:
      context: .
      dockerfile: Dockerfile
    image: mbirjax-profiler:latest
    container_name: mbirjax-profiler

    shm_size: '4gb'

    environment:
      # JAX XLA configuration for CPU-only profiling
      - JAX_PLATFORMS=cpu
      - XLA_PYTHON_CLIENT_PREALLOCATE=true
      - XLA_PYTHON_CLIENT_MEM_FRACTION=0.7
      # Output directory for profiling results
      - OUTPUT_DIR=/output

    ulimits:
      memlock:
        soft: -1
        hard: -1

    volumes:
      - ./output:/output
      - ./scripts:/scripts

    stdin_open: true
    tty: true
    working_dir: /output

